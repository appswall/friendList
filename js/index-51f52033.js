import{d as ue,u as Me,a as Ae,c as _,b as Qe,o as a,e as v,f as e,g as S,h as Ee,N as Se,F as re,w as c,i as Wt,j as t,t as G,n as xe,k as Kt,l as Bt,p as We,m as Ke,_ as me,q as Je,r as x,s as Xe,v as M,x as P,y as X,z as oe,A as Ze,B as i,C as T,D as et,E as tt,G as Jt,H as Ve,I as $e,J as Re,K as ce,L as ot,M as Xt,O as $t,P as Rt,Q as H,R as Zt,S as eo,T as yt,U as to,V as kt,W as oo,X as so,Y as no,Z as ao,$ as lo,a0 as te,a1 as bt,a2 as io,a3 as ro,a4 as wt,a5 as Be,a6 as ie,a7 as Fe,a8 as co}from"./index-54a3230b.js";import{M as uo,H as je,m as fo,a as po,c as ho,_ as Mt,f as Ct,h as vo,N as _o,b as Tt}from"./index-bc6047f5.js";import{i as xo}from"./index-7546c6a5.js";import{u as At,N as It,a as St}from"./index-db24b977.js";import{u as mo}from"./useWeChatBrowser-5e4944ad.js";import{b as go}from"./browser-a1ac24ac.js";const ge=s=>(We("data-v-10f3558b"),s=s(),Ke(),s),yo={class:"robot_info_box"},ko=ge(()=>t("p",{class:"info_title"},"好友信息",-1)),bo={class:"info_item"},wo=ge(()=>t("span",{class:"item_title text-[#86909c] drak_text_color2"},"昵称",-1)),Co={class:"item_describe"},To={class:"info_item"},Io=ge(()=>t("span",{class:"item_title text-[#86909c] drak_text_color2"},"备注",-1)),So={class:"item_describe"},Bo={class:"info_item"},$o=ge(()=>t("span",{class:"item_title text-[#86909c] drak_text_color2"},"招呼语",-1)),Ro={class:"item_describe"},Mo={class:"info_item"},Ao=ge(()=>t("span",{class:"item_title text-[#86909c] drak_text_color2"},"角色",-1)),Do={class:"item_describe"},Uo=ue({__name:"Avatar",props:{image:{type:Boolean}},setup(s){const m=Me(),{isMobile:r}=Ae(),g=_(()=>m.userInfo.avatar),u=_(()=>Bt()),d=Qe(),f=_(()=>d.theme),b=_(()=>f.value==="dark"?{backgroundColor:"#313a43 !important",maxWidth:"300px"}:{maxWidth:"300px"});return(z,$)=>s.image?(a(),v(re,{key:0},[e(xo)(e(g))&&e(g).length>0?(a(),S(e(Se),{key:0,src:e(g),"fallback-src":e(Ee),size:e(r)?36:44,round:""},null,8,["src","fallback-src","size"])):(a(),S(e(Se),{key:1,size:e(r)?36:44,round:"",src:e(Ee)},null,8,["size","src"]))],64)):(a(),S(e(Kt),{key:1,placement:"right",trigger:"click",style:xe(e(b))},{trigger:c(()=>[e(u)&&e(u).avatar?(a(),S(e(Se),{key:0,src:e(u).avatar,"fallback-src":e(Ee),size:e(r)?36:44,round:"",style:{cursor:"pointer"}},null,8,["src","fallback-src","size"])):(a(),S(e(Se),{key:1,size:e(r)?36:44,style:{cursor:"pointer"},round:"",src:e(Wt)},null,8,["size","src"]))]),default:c(()=>[t("div",yo,[ko,t("p",bo,[wo,t("span",Co,G(e(u).nickname),1)]),t("p",To,[Io,t("span",So,G(e(u).remark),1)]),t("p",Bo,[$o,t("span",Ro,G(e(u).greet),1)]),t("p",Mo,[Ao,t("span",Do,G(e(u).role),1)])])]),_:1},8,["style"]))}});const Po=me(Uo,[["__scopeId","data-v-10f3558b"]]),Oo={key:0,class:"flex items-end"},Lo={class:"w-full"},Yo=["innerHTML"],zo=["textContent"],Ho={key:2,class:"btn_box"},qo={key:0,class:"drak_text_color1 w-[4px] h-[20px] block animate-blink"},No=["textContent"],Go=ue({__name:"Text",props:{inversion:{type:Boolean},error:{type:Boolean},text:null,loading:{type:Boolean},asRawText:{type:Boolean},limits:{type:[Boolean,null]}},setup(s,{expose:m}){const r=s,g=Je(),{isMobile:u}=Ae(),d=x(),f=new uo({linkify:!0,highlight(C,p){if(!!(p&&je.getLanguage(p))){const A=p??"";return R(je.highlight(C,{language:A}).value,A)}return R(je.highlightAuto(C).value,"")}});f.use(fo,{attrs:{target:"_blank",rel:"noopener"}}),f.use(po,{blockClass:"katexmath-block rounded-md p-[10px]",errorColor:" #cc0000"});const b=_(()=>["text-wrap","min-w-[20px]","rounded-md","dark_bg_color1","bg-[#f5f7fb]",u.value?"p-2":"px-3 py-2",r.inversion?"message-request":"message-reply",{"text-red-500":r.error},{"max-w-[90%]":!u.value}]),z=_(()=>{const C=r.text??"";return r.asRawText?C:f.render(C)}),$=Me(),w=Xe(),D=_(()=>$.userInfo);let U=_(()=>w.activeId);function R(C,p){return`<pre class="code-block-wrapper"><div class="code-block-header"><span class="code-block-header__lang">${p}</span><span class="code-block-header__copy">${M("chat.copyCode")}</span></div><code class="hljs code-block-body ${p}">${C}</code></pre>`}m({textRef:d});function q(C){if(console.log(C,"type"),C==="login")g.push("/login");else if(C==="subs")if(u.value)g.push("/subscriptions");else{const p="subscriptions";g.push({path:"/my",query:{rightName:p}})}console.log(g)}function V(){if(r.loading)return;const{greet:C}=oe.get("robotInfo");w.clearChatById(U.value,C)}return(C,p)=>(a(),v("div",{class:X(["text-black",e(b)])},[t("div",{ref_key:"textRef",ref:d,class:"leading-relaxed break-words"},[s.inversion?(a(),v("div",{key:1,style:{"font-size":"14px"},class:"whitespace-pre-wrap drak_text_color1",textContent:G(e(z))},null,8,No)):(a(),v("div",Oo,[t("div",Lo,[s.asRawText?(a(),v("div",{key:1,style:{"font-size":"14px"},class:"w-full whitespace-pre-wrap",textContent:G(e(z))},null,8,zo)):(a(),v("div",{key:0,style:{"font-size":"14px"},class:"w-full markdown-body",innerHTML:e(z)},null,8,Yo)),s.limits?(a(),v("div",Ho,[e(D).isTourist&&s.limits===1?(a(),v("span",{key:0,class:"btn_text",onClick:p[0]||(p[0]=F=>q("login"))},"立马登录")):P("",!0),!e(D).expTime&&s.limits===1?(a(),v("span",{key:1,class:"btn_text",onClick:p[1]||(p[1]=F=>q("subs"))},"立马订阅")):P("",!0),e(D).expTime&&s.limits===1?(a(),v("span",{key:2,class:"btn_text",onClick:p[2]||(p[2]=F=>q("subs"))},"升级订阅")):P("",!0),s.limits===2||s.limits===1?(a(),v("span",{key:3,class:"btn_text",onClick:V},"开启新会话")):P("",!0)])):P("",!0)]),s.loading?(a(),v("span",qo)):P("",!0)]))],512)],2))}});const Eo=me(Go,[["__scopeId","data-v-95948532"]]),Fo={class:"flex flex-col"},jo={class:"transition text-neutral-300 hover:text-neutral-800 drak_hover_text"},Vo=ue({__name:"index",props:{dateTime:null,text:null,inversion:{type:Boolean},error:{type:Boolean},loading:{type:Boolean},isGreeting:{type:Boolean},limits:{type:[Boolean,null]}},emits:["regenerate","delete","resend"],setup(s,{emit:m}){const r=s,{toClipboard:g}=At(),u=Me(),d=Bt(),f=Ze(),b=_(()=>u.userInfo.name),z=_(()=>d.nickname),{isMobile:$}=Ae(),{iconRender:w}=tt(),D=x(),U=x(r.inversion),R=x(),q=_(()=>{const A=[{label:M("common.delete"),key:"delete",icon:w({icon:"ri:delete-bin-line"})}];return!r.inversion&&!r.isGreeting&&A.unshift({label:"重新生成",key:"refresh",icon:w({icon:"ri:restart-line"})}),r.inversion||A.unshift({label:U.value?M("chat.preview"):M("chat.showRawText"),key:"toggleRenderType",icon:w({icon:U.value?"ic:outline-code-off":"ic:outline-code"})}),r.inversion&&A.unshift({label:"重新发送",key:"resend",icon:w({icon:"ri:restart-line"})}),A}),V=async A=>{try{await g(A),f.success("复制成功")}catch{f.error("复制失败")}};function C(A){switch(A){case"refresh":p();return;case"toggleRenderType":U.value=!U.value;return;case"delete":m("delete");return;case"resend":m("resend");return}}function p(){var A;(A=R.value)==null||A.scrollIntoView(),m("regenerate")}function F(){V(r.text??"")}return(A,j)=>(a(),v("div",{ref_key:"messageRef",ref:R,class:X(["flex w-full mb-6 overflow-hidden",[{"flex-row-reverse":s.inversion}]])},[t("div",{class:X(["flex justify-center flex-shrink-0 overflow-hidden rounded-full",[s.inversion?"ml-2":"mr-2"]])},[i(Po,{image:s.inversion},null,8,["image"])],2),t("div",{class:X(["overflow-hidden text-sm",[s.inversion?"items-end":"items-start"]]),style:{width:"100%"}},[t("p",{class:X(["text-xs text-[#b4bbc4]",[s.inversion?"text-right":"text-left"]])},G(s.inversion?e(b):e(z)),3),t("div",{class:X(["flex items-end gap-1 mt-2",[s.inversion?"flex-row-reverse":"flex-row"]]),style:{position:"relative"}},[i(Eo,{ref_key:"textRef",ref:D,inversion:s.inversion,error:s.error,text:s.text,loading:s.loading,limits:s.limits,"as-raw-text":U.value},null,8,["inversion","error","text","loading","limits","as-raw-text"]),t("div",Fo,[t("button",{class:"mb-2 transition text-neutral-300",onClick:j[0]||(j[0]=Q=>F())},[i(e(T),{icon:"ri:file-copy-2-line"})]),i(e(et),{trigger:e($)?"click":"hover",placement:s.inversion?"left":"right",options:e(q),onSelect:C,class:"dark_bg_color4"},{default:c(()=>[t("button",jo,[i(e(T),{icon:"ri:more-2-fill"})])]),_:1},8,["trigger","placement","options"])])],2)],2)],2))}});const Qo=me(Vo,[["__scopeId","data-v-bfaadf58"]]);function Wo(s){return Jt({url:"/chat-api/robotQuestion/list",data:{robotId:s}})}const Ko=s=>(We("data-v-8d37795b"),s=s(),Ke(),s),Jo={key:0,class:"example_box drak_text_color1"},Xo={class:"example_title"},Zo=Ko(()=>t("p",{class:"text-[#495057] drak_text_color1"},"试试以下问题",-1)),es={class:"example_question"},ts=["onClick"],os=ue({__name:"index",props:{robotId:null,userInfo:null,isConcern:{type:Boolean}},emits:["question","openTipsModal"],setup(s,{emit:m}){const r=s,g=x([]),u=x(!1);let d=r.userInfo.loginType,f=_(()=>r.userInfo.hashMp);b();async function b(){const{data:D}=await Wo(r.robotId);g.value=D.robotQuestions,u.value=D.hashReload}function z(D){m("question",D)}function $(){m("openTipsModal")}const w=_(()=>d=="web_tourist"||d=="phone"||d=="wechat_authorization");return(D,U)=>g.value.length?(a(),v("div",Jo,[t("div",Xo,[Zo,u.value?(a(),v("div",{key:0,class:"btn_box",onClick:b},"换一批")):P("",!0)]),t("div",es,[(a(!0),v(re,null,Ve(g.value,(R,q)=>(a(),v("div",{class:"question_item bg-[#f5f7fb] dark_bg_color1",onClick:V=>z(R.question),key:q},G(R.question),9,ts))),128))]),$e(t("div",{class:"tipsAttention bg-[#f5f7fb] dark_bg_color1",onClick:$},"关注微信公众号《AI创新工坊 》永不迷路，额外赠送三天会员",512),[[Re,e(w)&&!s.isConcern&&e(f)==!1]])])):P("",!0)}});const ss=me(os,[["__scopeId","data-v-8d37795b"]]);function ns(){const s=x(null);return{scrollRef:s,scrollToBottom:async()=>{await ce(),s.value&&(s.value.scrollTop=s.value.scrollHeight)},scrollToTop:async()=>{await ce(),s.value&&(s.value.scrollTop=0)},scrollToBottomIfAtBottom:async()=>{await ce(),s.value&&s.value.scrollHeight-s.value.scrollTop-s.value.clientHeight<=100&&(s.value.scrollTop=s.value.scrollHeight)}}}function as(){const s=Xe();return{addChat:(d,f,b)=>{s.addChatById(d,f,b)},updateChat:(d,f,b)=>{s.updateChatById(d,f,b)},updateChatSome:(d,f,b)=>{s.updateChatSomeById(d,f,b)},getChatByUuidAndIndex:(d,f)=>s.getChatByIdAndIndex(d,f)}}function ls(){function s(){document.querySelectorAll(".code-block-wrapper").forEach(r=>{const g=r.querySelector(".code-block-header__copy"),u=r.querySelector(".code-block-body");g&&u&&g.addEventListener("click",()=>{var d;(d=navigator.clipboard)!=null&&d.writeText?navigator.clipboard.writeText(u.textContent??""):ho({text:u.textContent??"",origin:!0})})})}ot(()=>s()),Xt(()=>s())}function is(){const s=Ze(),m=$t(),r=_(()=>m.usingContext);function g(){m.setUsingContext(!r.value),r.value?s.success(M("chat.turnOnContext")):s.warning(M("chat.turnOffContext"))}return{usingContext:r,toggleUsingContext:g}}const rs={class:"sticky top-0 left-0 right-0 z-30 border-b dark_border3 bg-white/80 dark_bg_color8 backdrop-blur drak_text_color1",style:{height:"64px"}},cs={class:"relative flex items-center justify-between min-w-0 overflow-hidden h-14 bg-[#F7F7F7] dark_bg_color6",style:{height:"100%","align-items":"center"}},us={class:"flex items-center"},ds={class:"flex items-center space-x-2"},fs={class:"text-xl text-[#4f555e] drak_text_color1"},ps=t("div",null,[t("img",{src:Mt,alt:"",width:"20"})],-1),hs={class:"text-xl text-[#4f555e] drak_text_color1"},vs={class:"transition text-neutral-300"},_s={class:"text-xl text-[#4f555e] drak_text_color1"},xs={class:"text-xl"},ms=ue({__name:"index",props:{usingContext:{type:Boolean},isPlay:{type:Boolean}},emits:["export","change","topic","copy","toggleUsingContext","linkSiri","voicePlay"],setup(s,{emit:m}){const r=oe.get("robotInfo"),g=Je(),u=Rt(),d=Qe(),f=$t();_(()=>d.siderCollapsed);const b=_(()=>d.theme);_(()=>f.getChatHistoryByCurrentActive),ot(()=>{u.getSiriInfo()});const{iconRender:z}=tt(),$=[{label:"一键复制",key:"copy",icon:z({icon:"ri:file-copy-2-line"})},{label:"导出图片",key:"export",icon:z({icon:"icon-park-solid:picture"})}];function w(p){switch(p){case"copy":m("copy");return;case"export":m("export");return}}function D(){g.push("/robotList")}function U(){const p=document.querySelector("#scrollRef");p&&ce(()=>p.scrollTop=0)}function R(){m("change")}function q(){m("topic")}function V(){m("linkSiri")}function C(){m("voicePlay")}return(p,F)=>(a(),v("header",rs,[t("div",cs,[t("div",us,[t("button",{class:"flex items-center justify-center w-11 h-11",onClick:D},[i(e(T),{class:"text-3xl",icon:"ic:baseline-chevron-left"})])]),t("h1",{class:"flex-1 pr-6 overflow-hidden cursor-pointer select-none text-ellipsis whitespace-nowrap",onDblclick:U,style:{"font-weight":"bold","font-size":"16px"}},G(e(r).nickname)+" ",33),t("div",ds,[i(e(H),{onClick:C},{default:c(()=>[t("span",fs,[s.isPlay?(a(),S(e(T),{key:0,icon:"wpf:speaker"})):(a(),S(e(T),{key:1,icon:"ph:speaker-x-fill"}))])]),_:1}),$e(i(e(H),{onClick:V},{default:c(()=>[ps]),_:1},512),[[Re,e(u).siri.hasSiri&&e(u).siri.siriUrl]]),i(e(H),{onClick:q},{default:c(()=>[t("span",hs,[i(e(T),{icon:"material-symbols:note-add-outline"})])]),_:1}),i(e(H),null,{default:c(()=>[i(e(et),{trigger:"click",options:$,onSelect:w,class:"dark_bg_color4"},{default:c(()=>[t("button",vs,[t("span",_s,[i(e(T),{icon:"ri:download-2-line"})])])]),_:1})]),_:1}),i(e(H),{onClick:R},{default:c(()=>[t("span",xs,[e(b)==="dark"?(a(),S(e(T),{key:0,icon:"ri:moon-foggy-line"})):P("",!0),e(b)==="light"?(a(),S(e(T),{key:1,icon:"ri:sun-foggy-line"})):P("",!0)])]),_:1})])])]))}}),ye=s=>(We("data-v-18a0381c"),s=s(),Ke(),s),gs={class:"flex flex-col w-full h-full"},ys={class:"flex-1 overflow-hidden"},ks={key:0,class:"flex items-center justify-center mt-4 text-center text-neutral-300"},bs=ye(()=>t("span",null,"Aha~",-1)),ws={key:0},Cs=ye(()=>t("span",null,"停止",-1)),Ts={key:0,class:"w-full max-w-screen-xl m-auto"},Is={class:"flex items-center justify-between space-x-2"},Ss={class:"drak_text_color3"},Bs={key:1,class:"w-full max-w-screen-xl m-auto border-t border-[#f0eff5] dark_border1 pl-4 pr-4 pb-4"},$s={class:"flex justify-between"},Rs={class:"flex"},Ms={class:"text-xl text-[#4f555e] drak_text_color1"},As={class:"text-xl text-[#4f555e] drak_text_color1"},Ds={class:"text-xl text-[#4f555e] drak_text_color1"},Us={class:"transition text-neutral-300"},Ps={class:"text-xl text-[#4f555e] drak_text_color1"},Os=ye(()=>t("div",{class:"siriModalBox"},[t("img",{src:Mt,alt:"",width:"22"})],-1)),Ls={class:"text-xl text-[#4f555e] drak_text_color1"},Ys={class:"flex"},zs={class:"text-xl"},Hs={class:"text-xl"},qs=["innerHTML"],Ns={class:"footer_box"},Gs={class:"siriModalBox"},Es={class:"siriCode"},Fs=["src"],js=["href"],Vs=ye(()=>t("span",{style:{color:"#6255ed"}},"链接",-1)),Qs=ye(()=>t("h1",{style:{"font-size":"18px","font-weight":"600"}},"使用教程：",-1)),Ws={class:"text-xl text-[#4f555e] drak_text_color1"},Ks={class:"text-[#6b7280] drak_text_color5",style:{"white-space":"pre-wrap","text-indent":"2em"}},Js={style:{width:"260px",height:"260px"}},Xs=["src"],Zs={key:0},en=ue({__name:"index",setup(s){const m=Zt();let r=new AbortController;const g=lo(),u=Je(),d=eo(),f=Ze(),b=Rt(),{isWeiXin:z}=mo();ls();const $=_(()=>de.theme),{isMobile:w}=Ae(),{addChat:D,updateChat:U,updateChatSome:R,getChatByUuidAndIndex:q}=as(),{scrollRef:V,scrollToBottom:C,scrollToBottomIfAtBottom:p}=ns(),{usingContext:F,toggleUsingContext:A}=is();g.params;const j=x(!1),Q=Xe(),de=Qe(),st=Me(),De=_(()=>de.siderCollapsed),se=x(!1),Ue=x(!1),nt=x(""),Pe=x(""),at=x("关注微信公众号"),fe=x(!1),Oe=x(""),Le=x(""),pe=x(""),E=_(()=>st.userInfo),Dt=yt([{id:1,issue:"如何安装Siri助手？",reply:"扫描二维码或打开链接，按照提示，安装快捷指令; 第一次使用需要同意Siri访问网络地址。"},{id:2,issue:"如何使用Siri助手？",reply:'与平常的Siri使用没有区别，直接对着iPhone，"Hey Siri，智能助手" 直接开启与它的对话，智能助手是快捷指令的名称，您可以通过说不同的快捷指令名称，唤醒不同的智能助手。'},{id:3,issue:"您今日的免费体验次数已用完？",reply:"安装完快捷指令使用时，默认是游客账户，每天只有10次的免费体验次数；需要在快捷指令中绑定会员的AccessToken开启无限制的对话功能。"},{id:4,issue:"如何获取AccessToken？",reply:"登录系统，在“我的” - “使用指南” 下，点击“绑定Siri” 即可获取到您的AccessToken。"},{id:5,issue:"绑定用户AccessToken？",reply:"在iPhone中的快捷指令中，找到对应的快捷指令，打开并编辑，在第一个Text框，框下面带有AccessToken的标识，框中输入您的AccessToken即可关联您的会员账号。关联会员账号后，您的Siri聊天记录都会保存在您的历史会话里面，可以直接查看、下载"}]);let N,W=x(Q.robotId),B=x(Q.activeId);to(()=>Q.activeId,o=>{W.value=o});let ne=yt({showTable:!0}),O=_(()=>Q.getChatById(B.value)),lt=_(()=>O.value.filter(o=>!o.inversion&&!o.error));kt.on("changeRobotId",o=>{ht(),W.value=o.robotId,B.value=o.id,ne.showTable=!1,ce(()=>{O=_(()=>Q.getChatById(o.id)),ne.showTable=!0})});const L=x(""),Y=x(!1),ke=x(null),Ut=oo(),{promptList:it}=so(Ut),{iconRender:be}=tt(),Pt=[{label:"一键复制",key:"copy",icon:be({icon:"ri:file-copy-2-line"})},{label:"导出图片",key:"export",icon:be({icon:"icon-park-solid:picture"})}],{toClipboard:Ot}=At(),Lt=async o=>{try{await Ot(o),f.success("复制成功")}catch{f.error("复制失败")}};function Yt(o){switch(o){case"copy":ct();return;case"export":ut();return}}O.value.forEach((o,n)=>{o.loading&&R(B.value,n,{loading:!1})});function we(){ze()}let he="",Z="",ae=x(!1),Ye="SpeechSynthesisUtterance"in window;function rt(){Ye?(ae.value=!ae.value,ae.value&&Ce(),window.speechSynthesis.cancel()):(console.log("浏览器不支持 SpeechSynthesisUtterance"),f.error("当前浏览器不支持语音播报"))}function Ce(){if(ae.value&&Ye){if(he.length!=Z.length){let o=Z.substring(he.length);he=Z;const n=new SpeechSynthesisUtterance(o);n.rate=2,window.speechSynthesis.speak(n),n.onend=()=>{Ce()}}}else Ye||console.log("浏览器不支持 SpeechSynthesisUtterance")}async function ze(o){var k;const n=L.value||o;if(Y.value||!n||n.trim()==="")return;r=new AbortController,D(B.value,W.value,{dateTime:te(new Date).format("YYYY-MM-DD HH:mm:ss"),text:n,inversion:!0,error:!1,conversationOptions:null,requestOptions:{prompt:n,options:null}}),C(),Y.value=!0,L.value="";let l={};const h=(k=lt.value[lt.value.length-1])==null?void 0:k.conversationOptions;h&&(F.value?l={...h}:l.roomId=h.roomId),D(B.value,W.value,{dateTime:te(new Date).format("YYYY-MM-DD HH:mm:ss"),text:"",loading:!0,inversion:!1,error:!1,conversationOptions:null,requestOptions:{prompt:n,options:{...l}}}),C();try{let I=0;he="",Z="",await(async()=>{await Ct({prompt:n,robotId:W.value,type:1,options:l,signal:r.signal,onDownloadProgress:({event:K})=>{const Ge=K.target,{responseText:le}=Ge,ee=le.lastIndexOf(`
`,le.length-2);let ve=le;ee!==-1&&(ve=le.substring(ee));try{const J=JSON.parse(ve);I++,Z=J.text,I===1&&setTimeout(()=>Ce(),500),U(B.value,O.value.length-1,{dateTime:te(new Date).format("YYYY-MM-DD HH:mm:ss"),text:J.text??"",inversion:!1,error:!1,loading:!0,conversationOptions:{roomId:J.roomId,parentMessageId:J.id},requestOptions:{prompt:n,options:{...l}}}),p()}catch{}}}),R(B.value,O.value.length-1,{loading:!1})})()}catch(I){if(N=void 0,I.code&&I.code===1001&&(fe.value=!0,Le.value=E.value.isTourist?"游客您好，您今日的体验次数已用完，新用户微信扫码登录，赠送三天会员":"您今日体验次数已用完，请订阅后获取更佳体验!<br> 或者邀请好友使用，获取免费会员资格",Oe.value=E.value.isTourist?"登录GoGPT":"订阅GoGPT",pe.value=E.value.isTourist?"扫码登录":"立马订阅"),I.code===1005&&(N=1),I.code===1006&&(N=2),I.message==="canceled"){R(B.value,O.value.length-1,{loading:!1,limits:N}),p();return}const y=q(B.value,O.value.length-1);if(y!=null&&y.text&&y.text!==""){R(B.value,O.value.length-1,{text:`${y.text}`,error:!1,loading:!1,limits:N});return}U(B.value,O.value.length-1,{dateTime:te(new Date).format("YYYY-MM-DD HH:mm:ss"),text:"",inversion:!1,error:!0,limits:N,loading:!1,conversationOptions:{roomId:I==null?void 0:I.roomId,parentMessageId:I==null?void 0:I.id},requestOptions:{prompt:n,options:{...l}}}),p()}finally{Y.value=!1}}async function zt(o){if(Y.value)return;r=new AbortController;const{requestOptions:n,conversationOptions:l}=O.value[o],h=(n==null?void 0:n.prompt)??"";let k={},I={};n.options&&(k={...n.options}),l&&(I={...l}),Y.value=!0,U(B.value,o,{dateTime:te(new Date).format("YYYY-MM-DD HH:mm:ss"),text:"",inversion:!1,error:!1,loading:!0,conversationOptions:l,requestOptions:{prompt:h,options:{...k}}});try{let y=0;he="",Z="",await(async()=>{await Ct({prompt:h,robotId:W.value,type:2,options:I,signal:r.signal,onDownloadProgress:({event:Ge})=>{const le=Ge.target,{responseText:ee}=le,ve=ee.lastIndexOf(`
`,ee.length-2);let J=ee;ve!==-1&&(J=ee.substring(ve));try{const _e=JSON.parse(J);y++,Z=_e.text,y===1&&setTimeout(()=>Ce(),500),U(B.value,o,{dateTime:te(new Date).format("YYYY-MM-DD HH:mm:ss"),text:_e.text??"",inversion:!1,error:!1,loading:!0,conversationOptions:{roomId:_e.roomId,parentMessageId:_e.id},requestOptions:{prompt:h,options:{...k}}})}catch{}}}),R(B.value,o,{loading:!1})})()}catch(y){if(N=void 0,y.code&&y.code===1001&&(fe.value=!0,Le.value=E.value.isTourist?"游客您好，您今日的体验次数已用完，新用户微信扫码登录，赠送三天会员":"您今日体验次数已用完，请订阅后获取更佳体验!<br>或者邀请好友使用，获取免费会员资格",Oe.value=E.value.isTourist?"登录GoGPT":"订阅GoGPT",pe.value=E.value.isTourist?"扫码登录":"立马订阅"),y.code===1005&&(N=1),y.code===1006&&(N=2),y.message==="canceled"){R(B.value,o,{loading:!1,limits:N});return}const K=q(B.value,o);if(K!=null&&K.text&&K.text!==""){R(B.value,o,{text:`${K.text}`,error:!1,loading:!1,limits:N});return}U(B.value,o,{dateTime:te(new Date).format("YYYY-MM-DD HH:mm:ss"),text:`${y!=null&&y.text?y.text:"【程序异常,请稍后再试！】"}`,inversion:!1,error:!0,limits:N,loading:!1,conversationOptions:{roomId:y==null?void 0:y.roomId,parentMessageId:y==null?void 0:y.id},requestOptions:{prompt:h,options:{...k}}})}finally{Y.value=!1}}function ct(){let o="";const n=oe.get("robotInfo");O.value.forEach(l=>{l.inversion?o+="我："+l.text+`

`:o+=n.nickname+"："+l.text+`

`}),Lt(o)}function ut(){if(Y.value)return;const o=d.warning({title:M("chat.exportImage"),content:M("chat.exportImageConfirm"),positiveText:M("common.yes"),negativeText:M("common.no"),icon:be({icon:"material-symbols:privacy-tip-rounded",color:"#786df5"}),negativeButtonProps:{color:"#786df5"},positiveButtonProps:{color:"#786df5"},onPositiveClick:async()=>{try{o.loading=!0;const n=document.getElementById("image-wrapper"),h=(await vo(n,{useCORS:!0})).toDataURL("image/png"),k=document.createElement("a");k.style.display="none",k.href=h,k.setAttribute("download","chat-shot.png"),typeof k.download>"u"&&k.setAttribute("target","_blank"),document.body.appendChild(k),k.click(),document.body.removeChild(k),window.URL.revokeObjectURL(h),o.loading=!1,f.success(M("chat.exportSuccess")),Promise.resolve()}catch{f.error(M("chat.exportFailed"))}finally{o.loading=!1}}})}function dt(){$.value==="dark"?de.setTheme("light"):$.value==="light"&&de.setTheme("dark")}function Ht(o){Y.value||d.warning({title:M("chat.deleteMessage"),content:M("chat.deleteMessageConfirm"),positiveText:M("common.yes"),negativeText:M("common.no"),icon:be({icon:"material-symbols:privacy-tip-rounded",color:"#786df5"}),negativeButtonProps:{color:"#786df5"},positiveButtonProps:{color:"#786df5"},style:{background:$.value==="dark"?"#272c3b":""},onPositiveClick:()=>{ne.showTable=!1,ce(()=>{Q.deleteChatById(B.value,o),ne.showTable=!0})}})}function qt(){const{nickname:o}=oe.get("robotInfo");u.push({path:"/sessionList",query:{nickname:o,robotId:W.value}})}function ft(){if(Y.value)return;const{greet:o}=oe.get("robotInfo");Q.clearChatById(B.value,o)}function pt(o){w.value?o.key==="Enter"&&o.ctrlKey&&(o.preventDefault(),we()):o.key==="Enter"&&!o.shiftKey&&(o.preventDefault(),we())}function ht(){Y.value&&(r.abort(),Y.value=!1)}function Te(){de.setSiderCollapsed(!De.value)}function Nt(){u.push({path:"/my",query:{openModal:"inviteFriend"}}),Te()}function Gt(){z?u.push("/my"):u.push("/login"),sessionStorage.setItem("loginRecord","/robotChatDetails"),Te()}function Et(){pe.value=="扫码登录"?(at.value="微信扫码登录",_t()):pe.value=="立马订阅"&&(w.value?(u.push("/subscriptions"),Te()):u.push({path:"/my",query:{rightName:"subscriptions"}}))}function vt(){let o=b.siri.siriUrl;go.toDataURL(o).then(n=>{nt.value=n}).catch(n=>{}),Ue.value=!0}const He=x(120),qe=x(!1),Ie=x(!1);function Ft(){fe.value=!Ie.value}async function jt(){qe.value=!1,j.value=!0;let o=E.value.loginType;const{data:n}=await bt();j.value=!1,Pe.value=n.qrCode,Ne(n.ticket,o)}async function _t(){j.value=!0,se.value=!0;let o=E.value.loginType,{data:n}=await bt();Pe.value=n.qrCode,j.value=!1,Ne(n.ticket,o)}async function Ne(o,n){if(se.value){if(He.value==0){f.error("二维码已失效，请刷新"),qe.value=!0,He.value=110;return}else He.value--;if(n=="web_tourist"||n=="wechat_authorization"){const l=oe.get("channel")?oe.get("channel"):"",{data:h}=await io(o,l);if(h.isSuccess){se.value=!1,m.setToken(h==null?void 0:h.loginInfoVO.token),st.getUserData(),Ie.value=!0;return}}else if(n=="phone"){const{data:l}=await ro(o);if(l){f.success("绑定成功"),se.value=!1,Ie.value=!0;return}}setTimeout(()=>{Ne(o,n)},1e3)}}const xt=_(()=>L.value.startsWith("/")?it.value.filter(o=>o.key.toLowerCase().includes(L.value.substring(1).toLowerCase())).map(o=>({label:o.value,value:o.value})):[]),mt=o=>{for(const n of it.value)if(n.value===o.label)return[n.key];return[]},gt=_(()=>w.value?M("chat.placeholderMobile"):M("chat.placeholder")),Vt=_(()=>Y.value||!L.value||L.value.trim()===""),Qt=_(()=>{let o;return w.value&&(o=["p-4","sticky","left-0","bottom-0","right-0","p-2","pr-3","overflow-hidden"]),o});return ot(()=>{var o;C(),ke.value&&!w.value&&((o=ke.value)==null||o.focus())}),no(()=>{kt.off("changeRobotId")}),ao(()=>{Y.value&&r.abort()}),(o,n)=>(a(),v(re,null,[t("div",gs,[e(w)&&e(ne).showTable?(a(),S(ms,{key:0,"using-context":e(F),isPlay:e(ae),onExport:ut,onChange:dt,onTopic:ft,onCopy:ct,onToggleUsingContext:e(A),onLinkSiri:vt,onVoicePlay:rt},null,8,["using-context","isPlay","onToggleUsingContext"])):P("",!0),t("main",ys,[t("div",{id:"scrollRef",ref_key:"scrollRef",ref:V,class:"h-full overflow-hidden overflow-y-auto"},[t("div",{id:"image-wrapper",class:X(["w-full max-w-screen-xl m-auto dark_bg_color3",[e(w)?"p-2":"p-4"]])},[e(O).length?(a(),v(re,{key:1},[e(ne).showTable?(a(),v("div",ws,[(a(!0),v(re,null,Ve(e(O),(l,h)=>(a(),S(e(Qo),{key:h,"date-time":l.dateTime,text:l.text,inversion:l.inversion,error:l.error,loading:l.loading,isGreeting:h==0,limits:l.limits,onRegenerate:k=>zt(h),onDelete:k=>Ht(h),onResend:k=>ze(l.text)},null,8,["date-time","text","inversion","error","loading","isGreeting","limits","onRegenerate","onDelete","onResend"]))),128)),$e(t("div",{class:"sticky bottom-0 left-0 flex justify-center stop_box",onClick:ht},[i(e(_o),{size:"tiny",stroke:"#7269ef"}),Cs],512),[[Re,Y.value]]),e(O).length===1?(a(),S(ss,{key:0,robotId:e(W),userInfo:e(E),isConcern:Ie.value,onQuestion:ze,onOpenTipsModal:_t},null,8,["robotId","userInfo","isConcern"])):P("",!0)])):P("",!0)],64)):(a(),v("div",ks,[i(e(T),{icon:"ri:bubble-chart-fill",class:"mr-2 text-3xl"}),bs]))],2)],512)]),t("footer",{class:X(e(Qt))},[e(w)?(a(),v("div",Ts,[t("div",Is,[i(e(Tt),{value:L.value,"onUpdate:value":n[1]||(n[1]=l=>L.value=l),options:e(xt),"render-label":mt},{default:c(({handleInput:l,handleBlur:h,handleFocus:k})=>[i(e(wt),{ref_key:"inputRef",ref:ke,value:L.value,"onUpdate:value":n[0]||(n[0]=I=>L.value=I),type:"textarea",placeholder:e(gt),autosize:{minRows:1,maxRows:e(w)?4:8},onInput:l,onFocus:k,onBlur:h,onKeypress:pt,class:"na_input_box",style:xe({border:e($)==="dark"?"1px solid #454c54":"1px solid #e0e0e6"})},null,8,["value","placeholder","autosize","onInput","onFocus","onBlur","style"])]),_:1},8,["value","options"]),i(e(Be),{type:"primary",color:"#7269ef","text-color":"#ffffff",disabled:e(Vt),onClick:we},{icon:c(()=>[t("span",Ss,[i(e(T),{icon:"ri:send-plane-fill"})])]),_:1},8,["disabled"])])])):(a(),v("div",Bs,[t("div",$s,[t("div",Rs,[i(e(H),{tooltip:e(De)?"展开":"隐藏",onClick:Te},{default:c(()=>[t("span",Ms,[e(De)?(a(),S(e(T),{key:0,icon:"mdi:chevron-right-circle-outline"})):(a(),S(e(T),{key:1,icon:"mdi:chevron-left-circle-outline"}))])]),_:1},8,["tooltip"]),i(e(H),{tooltip:"历史会话",onClick:qt},{default:c(()=>[t("span",As,[i(e(T),{icon:"icon-park-outline:topic-discussion"})])]),_:1}),i(e(H),{tooltip:"新会话",onClick:ft},{default:c(()=>[t("span",Ds,[i(e(T),{icon:"material-symbols:note-add-outline"})])]),_:1}),i(e(H),null,{default:c(()=>[i(e(et),{trigger:"hover",options:Pt,onSelect:Yt,class:"dark_bg_color4"},{default:c(()=>[t("button",Us,[t("span",Ps,[i(e(T),{icon:"ri:download-2-line"})])])]),_:1})]),_:1}),$e(i(e(H),{tooltip:"用苹果Siri与好友对话",onClick:vt},{default:c(()=>[Os]),_:1},512),[[Re,e(b).getSiriInfo().hasSiri]]),i(e(H),{tooltip:"语音播报",onClick:rt},{default:c(()=>[t("span",Ls,[e(ae)?(a(),S(e(T),{key:0,icon:"wpf:speaker"})):(a(),S(e(T),{key:1,icon:"ph:speaker-x-fill"}))])]),_:1})]),t("div",Ys,[i(e(H),{tooltip:"主题切换",onClick:dt},{default:c(()=>[t("span",zs,[e($)==="dark"?(a(),S(e(T),{key:0,icon:"ri:moon-foggy-line"})):P("",!0),e($)==="light"?(a(),S(e(T),{key:1,icon:"ri:sun-foggy-line"})):P("",!0)])]),_:1}),i(e(H),{tooltip:"发送",onClick:we},{default:c(()=>[t("span",Hs,[i(e(T),{icon:"ri:send-plane-fill"})])]),_:1})])]),t("div",null,[i(e(Tt),{value:L.value,"onUpdate:value":n[3]||(n[3]=l=>L.value=l),options:e(xt),"render-label":mt},{default:c(({handleInput:l,handleBlur:h,handleFocus:k})=>[i(e(wt),{ref_key:"inputRef",ref:ke,value:L.value,"onUpdate:value":n[2]||(n[2]=I=>L.value=I),type:"textarea",placeholder:e(gt),autosize:{minRows:3,maxRows:e(w)?4:8},onInput:l,onFocus:k,onBlur:h,onKeypress:pt,maxlength:"2000","show-count":"",class:"na_input_box"},null,8,["value","placeholder","autosize","onInput","onFocus","onBlur"])]),_:1},8,["value","options"])])]))],2)]),i(e(Fe),{show:fe.value,"onUpdate:show":n[4]||(n[4]=l=>fe.value=l),class:"custom-card",preset:"card",style:xe({backgroundColor:e($)==="dark"?"#272c3b":"#ffffff",width:"400px"}),title:Oe.value,size:"huge",bordered:!1,"mask-closable":!1},{footer:c(()=>[t("div",Ns,[e(E).isTourist?(a(),S(e(Be),{key:0,onClick:Gt},{default:c(()=>[ie("普通登录")]),_:1})):(a(),S(e(Be),{key:1,onClick:Nt},{default:c(()=>[ie("邀请好友")]),_:1})),i(e(Be),{onClick:Et,type:"primary",color:"#7269ef","text-color":"#ffffff"},{default:c(()=>[ie(G(pe.value),1)]),_:1})])]),default:c(()=>[t("div",{innerHTML:Le.value},null,8,qs)]),_:1},8,["show","style","title"]),t("template",null,[i(e(Fe),{show:Ue.value,"onUpdate:show":n[5]||(n[5]=l=>Ue.value=l),class:"custom-card",preset:"card","header-style":{padding:"26px 30px"},"footer-style":{padding:"0 30px"},style:xe({backgroundColor:e($)==="dark"?"#272c3b":"#ffffff",width:"340px",textAlign:"center"}),title:"用苹果Siri直接与"+e(b).siri.nickName+"对话",size:"huge",bordered:!1,closable:!1,"mask-closable":!0},{default:c(()=>[t("div",Gs,[t("div",Es,[t("img",{src:nt.value,alt:""},null,8,Fs)]),t("a",{href:e(b).siri.siriUrl,target:"_blank"},[ie("苹果用户直接点开"),Vs],8,js),i(e(It),{class:"n_collapse","default-expanded-names":["1"]},{default:c(()=>[i(e(St),{title:"使用教程：",name:"1"},{header:c(()=>[Qs]),default:c(()=>[(a(!0),v(re,null,Ve(Dt,(l,h)=>(a(),S(e(It),{key:l.id,"arrow-placement":"right"},{default:c(()=>[i(e(St),{title:h+1+"、"+l.issue},{arrow:c(()=>[t("span",Ws,[i(e(T),{icon:"ph:caret-right-fill"})])]),default:c(()=>[t("div",Ks,G(l.reply),1)]),_:2},1032,["title"])]),_:2},1024))),128))]),_:1})]),_:1})])]),_:1},8,["show","style","title"])]),t("template",null,[i(e(Fe),{show:se.value,"onUpdate:show":n[6]||(n[6]=l=>se.value=l),class:"custom-card",preset:"card","header-style":{padding:"26px 30px"},"footer-style":{padding:"0 30px"},style:xe({backgroundColor:e($)==="dark"?"#272c3b":"#ffffff",width:"340px",textAlign:"center"}),title:at.value,size:"huge",bordered:!1,closable:!1,"mask-closable":!0,onAfterLeave:Ft},{default:c(()=>[t("div",Js,[i(co,{loading:j.value},null,8,["loading"]),t("img",{src:Pe.value,alt:""},null,8,Xs),qe.value?(a(),v("p",Zs,[ie(" 该二维码已失效，请"),t("a",{onClick:jt,style:{color:"#7269ef",cursor:"pointer"}},"刷新"),ie("二维码 ")])):P("",!0)])]),_:1},8,["show","style","title"])])],64))}});const rn=me(en,[["__scopeId","data-v-18a0381c"]]);export{rn as default};
